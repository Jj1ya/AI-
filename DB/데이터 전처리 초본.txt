import pandas as pd
from pymongo import MongoClient

# MongoDB 연결
client = MongoClient('mongodb+srv://ltfc83:Chlwldnd1220@cluster0.lp68icz.mongodb.net/')
db = client['국제시장_분석데이터']
collection = db['경질유']

# MongoDB에서 데이터 불러오기
data = list(collection.find())

# 데이터프레임으로 변환
df = pd.DataFrame(data)

# 데이터 전처리
# 1. 열 이름 확인
print(df.columns)

# 2. 결측값 처리
df.fillna(0, inplace=True)

# 3. 이상치 제거
# 'value' 열이 없다면 적절한 열 이름으로 수정해야 합니다.
df = df[(df['value'] > 0) & (df['value'] < 100)]

# 4. 데이터 정규화
df['normalized_value'] = (df['value'] - df['value'].mean()) / df['value'].std()

# 전처리된 데이터 다시 MongoDB에 저장
preprocessed_collection = db['preprocessed_data']
preprocessed_collection.insert_many(df.to_dict(orient='records'))

# MongoDB 연결 종료
client.close()
